<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>trick shelf</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 0;
      padding: 12px;
      background: #fafafa;
    }

    h1 {
      font-size: 18px;
      margin-bottom: 12px;
    }

    .form {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 16px;
    }

    input, textarea, button {
      font-size: 16px;
      padding: 8px;
    }

    textarea {
      resize: vertical;
      min-height: 60px;
    }

    ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .item-card {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 6px;
      border-bottom: 1px solid #ddd;
    }

    .item-card.edit-mode {
      background: #ffecec;
    }

    .item-left a {
      text-decoration: none;
      color: #333;
      font-size: 16px;
    }

    .item-right {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .icon-btn {
      background: none;
      border: none;
      font-size: 18px;
      padding: 6px;
    }
  </style>
</head>
<body>

<h1>trick shelf</h1>

<div class="form">
  <input id="title" placeholder="ãƒˆãƒªãƒƒã‚¯å" />
  <input id="url" placeholder="URL" />
  <textarea id="memo" placeholder="ã‚³ãƒ„ãƒ»æ°—ã¥ãï¼ˆä»»æ„ï¼‰"></textarea>
  <button id="add">è¿½åŠ </button>
</div>

<ul id="list"></ul>

<script>
  const OLD_KEY = "yoyo-tricks";
  const STORAGE_KEY = "trickShelfItems";

  // ===== ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ =====
  let items = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");

  // ===== æ—§ãƒ‡ãƒ¼ã‚¿ç§»è¡Œï¼ˆ1å›žã®ã¿ï¼‰=====
  const oldData = JSON.parse(localStorage.getItem(OLD_KEY) || "null");
  if (oldData && items.length === 0) {
    items = oldData.map((item, index) => ({
      title: item.name,
      url: item.url || "",
      memo: item.memo || "",
      createdAt: Date.now() - index,
      order: index
    }));
    save();
  }

  // ===== ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ï¼šè¡Œå˜ä½ =====
  let editIndex = null;

  function save() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
  }

  function render() {
    const list = document.getElementById("list");
    list.innerHTML = "";

    // order ã‚’å¿…ãšä½¿ã†
    items.sort((a, b) => (a.order ?? 0) - (b.order ?? 0));

    items.forEach((item, index) => {
      const li = document.createElement("li");
      li.className = "item-card" + (editIndex === index ? " edit-mode" : "");

      // å·¦ï¼šã‚¿ã‚¤ãƒˆãƒ«ãƒªãƒ³ã‚¯
      const left = document.createElement("div");
      left.className = "item-left";

      const a = document.createElement("a");
      a.href = item.url;
      a.textContent = item.title;
      a.target = "_blank";
      a.rel = "noopener";

      left.appendChild(a);

      // å³ï¼šæ“ä½œ
      const right = document.createElement("div");
      right.className = "item-right";

      // â“˜ ãƒœã‚¿ãƒ³
      const info = document.createElement("button");
      info.className = "icon-btn";
      info.textContent = "â“˜";

      info.onclick = (e) => {
        e.preventDefault();
        e.stopPropagation();
        alert(item.memo || "ãƒ¡ãƒ¢ãªã—");
      };

      info.oncontextmenu = (e) => {
        e.preventDefault();
        const text = prompt("ãƒ¡ãƒ¢ã‚’ç·¨é›†", item.memo || "");
        if (text !== null) {
          item.memo = text;
          save();
        }
      };

      right.appendChild(info);

      // å‰Šé™¤ï¼ˆç·¨é›†ãƒ¢ãƒ¼ãƒ‰ä¸­ã®ã¿ï¼‰
      if (editIndex === index) {
        const del = document.createElement("button");
        del.className = "icon-btn";
        del.textContent = "ðŸ—‘ï¸";
        del.onclick = () => {
          if (confirm("å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
            items.splice(index, 1);
            items.forEach((it, i) => it.order = i);
            editIndex = null;
            save();
            render();
          }
        };
        right.appendChild(del);
      }

      // é•·æŠ¼ã—ã§ç·¨é›†ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆè¡Œå˜ä½ï¼‰
      let timer;
      li.addEventListener("touchstart", () => {
        timer = setTimeout(() => {
          editIndex = (editIndex === index) ? null : index;
          render();
        }, 600);
      });
      li.addEventListener("touchend", () => clearTimeout(timer));

      li.appendChild(left);
      li.appendChild(right);
      list.appendChild(li);
    });
  }

  // ===== è¿½åŠ  =====
  document.getElementById("add").onclick = () => {
    const title = document.getElementById("title").value.trim();
    const url = document.getElementById("url").value.trim();
    const memo = document.getElementById("memo").value.trim();

    if (!title || !url) return;

    items.push({
      title,
      url,
      memo,
      createdAt: Date.now(),
      order: items.length
    });

    save();
    render();

    document.getElementById("title").value = "";
    document.getElementById("url").value = "";
    document.getElementById("memo").value = "";
  };

  render();
</script>

</body>
</html>